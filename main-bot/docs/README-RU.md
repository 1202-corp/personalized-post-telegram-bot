# Main Bot

> [English version](../README.md)

Telegram бот на Aiogram 3.x с AARRR воронкой для персонализированных рекомендаций постов.

## Описание

Основной бот обрабатывает взаимодействие с пользователями, флоу обучения, доставку персонализированной ленты и retention nudges. Использует паттерн registry для управления различными типами сообщений (системные, временные, одноразовые).

## Основные функции

- Онбординг и обучение пользователей
- Персонализированная лента на основе ML-рекомендаций
- Интеграция с MiniApp для swipe интерфейса
- Retention сервис для неактивных пользователей
- Мультиязычность (en/ru)
- Управление сообщениями через registry pattern

## Технологии

- **Aiogram 3.x** — Фреймворк для Telegram Bot API
- **FSM (MemoryStorage)** — Управление состояниями пользователей
- **httpx** — HTTP клиент для коммуникации с API

## Структура

```
bot/
├── main.py              # Точка входа
├── config.py            # Настройки
├── api_client.py        # HTTP клиенты для API
├── message_manager.py   # Registry Pattern для сообщений
├── keyboards.py         # Inline клавиатуры
├── texts.py             # Локализация
├── retention.py         # Retention сервис
└── handlers/
    ├── commands.py      # Команды бота
    ├── training.py      # Флоу обучения
    └── feed.py          # Флоу ленты
```

## MessageManager (Registry Pattern)

Управление тремя типами сообщений:
- `SYSTEM` - Постоянные, редактируются in-place
- `EPHEMERAL` - Временные, удаляются после взаимодействия
- `ONETIME` - Остаются в истории

## Handlers

- **commands.py** - `/start`, `/help`, `/status`, `/reset`
- **training.py** - Флоу обучения с оценкой постов
- **feed.py** - Персонализированная лента и бонусный канал

## Retention Service

Фоновый сервис для удержания неактивных пользователей через отправку лучших постов.

